name: trivy

on:
  push:
    branches: ["master"]
  pull_request:
    branches: ["master"]

permissions:
  contents: read



jobs:
  trivy-scan:
    name: trivy-scan
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Run Trivy for Docker Image Scan
      uses: aquasecurity/trivy-action@0.28.0
      with:
        image-ref: 'mongo:4.4' # Correct image reference
        scan-type: 'image'    # Change scan type to 'image'
        format: "template"
        template: '@/contrib/html.tpl'
        output: 'trivy-results.html'
        severity: 'CRITICAL,HIGH'
    - name: Upload Trivy HTML Report as an artifact
      uses: actions/upload-artifact@v4
      with:
        name: trivy-html-report
        path: trivy-results.html
